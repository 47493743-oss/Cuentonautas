<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Puzzle Galaxy | Prototipo de juego de rompecabezas</title>
  <meta name="description" content="Prototipo de rompecabezas espacial con niveles deslizables, animaciones suaves y sistema de logros listo para personalizar." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f172a;
      --bg-soft: #111a31;
      --bg-card: rgba(15, 23, 42, 0.75);
      --ink: #f8fafc;
      --muted: rgba(248, 250, 252, 0.72);
      --primary: #38bdf8;
      --primary-strong: #0ea5e9;
      --accent: #c084fc;
      --success: #4ade80;
      --warning: #facc15;
      --danger: #f87171;
      --radius: 22px;
      color-scheme: dark;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      min-height: 100%;
      background: radial-gradient(circle at 15% 20%, rgba(56, 189, 248, 0.2), transparent 45%),
        radial-gradient(circle at 80% 12%, rgba(192, 132, 252, 0.26), transparent 50%),
        radial-gradient(circle at 60% 80%, rgba(74, 222, 128, 0.18), transparent 55%),
        linear-gradient(140deg, var(--bg), #020617 70%);
      color: var(--ink);
      font-family: 'Quicksand', system-ui, -apple-system, 'Segoe UI', sans-serif;
      line-height: 1.7;
    }

    header {
      position: sticky;
      top: 0;
      backdrop-filter: blur(12px) saturate(170%);
      background: rgba(15, 23, 42, 0.65);
      border-bottom: 1px solid rgba(148, 163, 184, 0.18);
      z-index: 50;
    }

    .wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 24px;
    }

    .bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 0;
      gap: 16px;
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: inherit;
    }

    .logo {
      width: 44px;
      height: 44px;
      border-radius: 14px;
      display: grid;
      place-items: center;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      font-family: 'Fredoka', sans-serif;
      font-weight: 700;
      font-size: 1.4rem;
      color: white;
      box-shadow: 0 18px 38px rgba(14, 165, 233, 0.28);
    }

    nav a {
      text-decoration: none;
      color: var(--muted);
      margin-left: 18px;
      font-weight: 600;
    }

    nav a:hover,
    nav a:focus-visible {
      color: var(--primary);
    }

    main {
      padding: 48px 0 80px;
      display: grid;
      gap: 64px;
    }

    .hero {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 42px;
      align-items: center;
    }

    h1 {
      margin: 0 0 16px;
      font-family: 'Fredoka', sans-serif;
      font-size: clamp(2rem, 4.2vw, 3.2rem);
      line-height: 1.08;
      letter-spacing: -0.01em;
    }

    h2 {
      font-family: 'Fredoka', sans-serif;
      font-size: clamp(1.5rem, 3vw, 2.4rem);
      margin-bottom: 12px;
    }

    p.lead {
      color: var(--muted);
      font-size: 1.1rem;
      margin-bottom: 18px;
    }

    .cta {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 20px;
      border-radius: 999px;
      border: 2px solid transparent;
      font-weight: 700;
      color: var(--ink);
      background: var(--primary-strong);
      cursor: pointer;
      text-decoration: none;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .btn:hover,
    .btn:focus-visible {
      transform: translateY(-2px);
      box-shadow: 0 18px 28px rgba(56, 189, 248, 0.28);
    }

    .btn.alt {
      background: transparent;
      border-color: rgba(148, 163, 184, 0.35);
      color: var(--muted);
    }

    .galaxy-card {
      position: relative;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.2), transparent 55%),
        var(--bg-card);
      padding: 26px;
      border-radius: var(--radius);
      box-shadow: 0 26px 42px rgba(2, 6, 23, 0.55);
      border: 1px solid rgba(148, 163, 184, 0.12);
    }

    .floating {
      position: absolute;
      inset: 14px;
      border-radius: var(--radius);
      border: 1px dashed rgba(148, 163, 184, 0.16);
      pointer-events: none;
    }

    .stars {
      position: absolute;
      inset: 0;
      overflow: hidden;
      border-radius: var(--radius);
      pointer-events: none;
    }

    .stars span {
      position: absolute;
      width: 6px;
      height: 6px;
      background: rgba(248, 250, 252, 0.85);
      border-radius: 999px;
      filter: drop-shadow(0 0 8px rgba(148, 163, 184, 0.45));
      animation: twinkle 6s ease-in-out infinite;
    }

    .stars span:nth-child(odd) {
      animation-delay: 2s;
    }

    @keyframes twinkle {
      0%,
      100% {
        opacity: 0.2;
        transform: scale(0.7);
      }

      50% {
        opacity: 1;
        transform: scale(1.15);
      }
    }

    .game-section {
      display: grid;
      gap: 28px;
    }

    .game-layout {
      display: grid;
      gap: 28px;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      align-items: start;
    }

    .panel {
      background: rgba(15, 23, 42, 0.78);
      padding: 24px;
      border-radius: var(--radius);
      border: 1px solid rgba(148, 163, 184, 0.12);
      box-shadow: 0 18px 28px rgba(2, 6, 23, 0.45);
    }

    .panel h3 {
      margin-top: 0;
      font-family: 'Fredoka', sans-serif;
      font-size: 1.4rem;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
      margin: 18px 0;
    }

    .stat {
      background: rgba(15, 23, 42, 0.85);
      border-radius: 18px;
      padding: 16px;
      border: 1px solid rgba(148, 163, 184, 0.1);
    }

    .stat span {
      display: block;
      color: var(--muted);
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .stat strong {
      font-size: 1.4rem;
      font-family: 'Fredoka', sans-serif;
    }

    .board {
      width: min(420px, 90vw);
      aspect-ratio: 1 / 1;
      background: rgba(15, 23, 42, 0.6);
      border-radius: 26px;
      padding: 18px;
      display: grid;
      gap: 12px;
      border: 1px solid rgba(148, 163, 184, 0.18);
      box-shadow: inset 0 0 18px rgba(14, 165, 233, 0.08);
    }

    .tile {
      border: 0;
      border-radius: 18px;
      font-family: 'Fredoka', sans-serif;
      font-size: clamp(1.6rem, 5vw, 2.2rem);
      font-weight: 700;
      color: var(--ink);
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.75), rgba(14, 165, 233, 0.95));
      cursor: pointer;
      display: grid;
      place-items: center;
      transition: transform 0.18s ease, box-shadow 0.18s ease;
    }

    .tile:hover,
    .tile:focus-visible {
      transform: translateY(-4px);
      box-shadow: 0 14px 24px rgba(14, 165, 233, 0.28);
    }

    .tile.empty {
      background: rgba(15, 23, 42, 0.3);
      border: 1px dashed rgba(148, 163, 184, 0.2);
      cursor: default;
      box-shadow: none;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 8px;
    }

    select,
    .btn.small {
      padding: 10px 16px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.68);
      color: var(--ink);
      border: 1px solid rgba(148, 163, 184, 0.26);
      font-weight: 600;
      font-family: inherit;
    }

    .btn.small {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      background: rgba(14, 165, 233, 0.18);
      border-color: rgba(56, 189, 248, 0.48);
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .status {
      margin-top: 18px;
      padding: 16px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.68);
      border: 1px solid rgba(148, 163, 184, 0.18);
      min-height: 56px;
    }

    .status strong {
      font-family: 'Fredoka', sans-serif;
      font-size: 1.1rem;
    }

    .feature-grid {
      display: grid;
      gap: 18px;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    }

    .feature-grid article {
      background: rgba(15, 23, 42, 0.72);
      border-radius: var(--radius);
      padding: 20px;
      border: 1px solid rgba(148, 163, 184, 0.14);
      box-shadow: 0 18px 28px rgba(2, 6, 23, 0.42);
    }

    .feature-grid h3 {
      font-family: 'Fredoka', sans-serif;
      margin-top: 0;
    }

    ul.features {
      list-style: none;
      padding-left: 0;
      display: grid;
      gap: 10px;
      margin: 0;
    }

    ul.features li {
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }

    ul.features li span {
      font-size: 1.2rem;
      margin-top: 2px;
    }

    .update-list {
      display: grid;
      gap: 14px;
    }

    .update-list li {
      display: grid;
      gap: 6px;
    }

    #modes {
      background: rgba(15, 23, 42, 0.55);
      border: 1px solid rgba(148, 163, 184, 0.12);
      border-radius: var(--radius);
      padding: 36px 32px;
      display: grid;
      gap: 12px;
    }

    .mode-cards {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: 18px;
    }

    .mode-cards li {
      display: grid;
      gap: 6px;
      padding: 18px 20px;
      border-radius: calc(var(--radius) - 6px);
      background: rgba(15, 23, 42, 0.75);
      border: 1px solid rgba(148, 163, 184, 0.16);
    }

    .mode-cards strong {
      font-family: 'Fredoka', sans-serif;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .mode-cards strong span {
      display: inline-grid;
      place-items: center;
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.4), rgba(192, 132, 252, 0.35));
      font-size: 0.95rem;
      color: var(--ink);
      font-weight: 700;
    }

    .faq {
      display: grid;
      gap: 24px;
      padding: 32px;
      border-radius: var(--radius);
      background: rgba(15, 23, 42, 0.5);
      border: 1px solid rgba(148, 163, 184, 0.18);
      box-shadow: 0 22px 40px rgba(2, 6, 23, 0.35);
    }

    .faq header h2 {
      margin-bottom: 6px;
    }

    .faq header p {
      margin: 0;
    }

    .faq-list {
      display: grid;
      gap: 20px;
    }

    .faq-card {
      padding: 22px;
      border-radius: calc(var(--radius) - 6px);
      background: rgba(15, 23, 42, 0.65);
      border: 1px solid rgba(56, 189, 248, 0.22);
    }

    .faq-card h3 {
      font-family: 'Fredoka', sans-serif;
      margin-top: 0;
      margin-bottom: 12px;
      font-size: 1.25rem;
    }

    .faq-card p {
      margin: 0 0 12px;
      color: var(--muted);
    }

    .faq-card p:last-child {
      margin-bottom: 0;
    }

    footer {
      margin-top: 64px;
      padding: 32px 0;
      border-top: 1px solid rgba(148, 163, 184, 0.2);
      color: var(--muted);
      font-size: 0.9rem;
      text-align: center;
    }

    @media (max-width: 720px) {
      header {
        position: static;
      }

      nav {
        display: none;
      }

      .board {
        width: 100%;
        padding: 14px;
        gap: 10px;
        border-radius: 20px;
      }

      .faq {
        padding: 24px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap bar">
      <a class="brand" href="#inicio">
        <span class="logo">PG</span>
        <span>Puzzle Galaxy</span>
      </a>
      <nav>
        <a href="#juego">Demo interactiva</a>
        <a href="#features">Caracter√≠sticas</a>
        <a href="#modes">Modos</a>
        <a href="#updates">Actualizaciones</a>
      </nav>
    </div>
  </header>
  <main class="wrap" id="inicio">
    <section class="hero">
      <div>
        <h1>Puzzle Galaxy: un rompecabezas espacial listo para jugar</h1>
        <p class="lead">Puzzle Galaxy combina tableros deslizables, animaciones suaves y un sistema de logros que engancha a las y los fans de los rompecabezas. Juega en el navegador, adapta los estilos a tu identidad y sorprende con una experiencia pulida.</p>
        <div class="cta">
          <a class="btn" href="#juego">Probar ahora</a>
          <a class="btn alt" href="#features">Ver caracter√≠sticas</a>
        </div>
      </div>
      <div class="galaxy-card" aria-hidden="true">
        <div class="floating"></div>
        <div class="stars">
          <span style="top:12%;left:16%;animation-duration:8s"></span>
          <span style="top:42%;left:68%;animation-duration:6.5s"></span>
          <span style="top:78%;left:32%;animation-duration:7.2s"></span>
          <span style="top:24%;left:80%;animation-duration:5.8s"></span>
          <span style="top:60%;left:12%;animation-duration:9s"></span>
        </div>
        <img src="https://images.unsplash.com/photo-1559757175-0eb30cd612da?auto=format&fit=crop&w=900&q=60" alt="Ilustraci√≥n espacial" style="width:100%;border-radius:16px;filter:grayscale(0.2) brightness(1.1);mix-blend-mode:screen;">
      </div>
    </section>

    <section class="game-section" id="juego">
      <header>
        <h2>Demo interactiva del puzzle deslizante</h2>
        <p class="lead">Pon a prueba la mec√°nica principal. El motor genera tableros resolubles, contabiliza movimientos y tiempos, y persiste el mejor r√©cord en el almacenamiento local.</p>
      </header>
      <div class="game-layout">
        <div>
          <div class="board" role="application" aria-label="Tablero del rompecabezas"></div>
          <div class="controls">
            <button class="btn small" data-action="shuffle">üîÑ Nuevo desaf√≠o</button>
            <button class="btn small" data-action="hint">üí° Movimiento sugerido</button>
            <label>
              <span class="sr-only">Seleccionar dificultad</span>
              <select aria-label="Seleccionar dificultad">
                <option value="3">F√°cil 3x3</option>
                <option value="4" selected>Normal 4x4</option>
                <option value="5">Experto 5x5</option>
              </select>
            </label>
          </div>
          <div class="status" role="status" aria-live="polite"></div>
        </div>
        <aside class="panel">
          <h3>Progresi√≥n del jugador</h3>
          <div class="stats">
            <div class="stat">
              <span>Movimientos</span>
              <strong id="moves">0</strong>
            </div>
            <div class="stat">
              <span>Tiempo</span>
              <strong id="time">00:00</strong>
            </div>
            <div class="stat">
              <span>Mejor marca</span>
              <strong id="best">--</strong>
            </div>
          </div>
          <p>Integra misiones diarias, modo contrarreloj y power-ups visuales para incrementar la retenci√≥n. La l√≥gica est√° encapsulada en JavaScript puro para que puedas migrarla f√°cilmente a React Native, Flutter o motores como Unity (UI Toolkit).</p>
        </aside>
      </div>
    </section>

    <section id="features">
      <h2>Caracter√≠sticas principales del juego</h2>
      <p class="lead">Cada detalle de Puzzle Galaxy est√° pensado para ofrecer partidas fluidas, retadoras y visualmente memorables.</p>
      <div class="feature-grid">
        <article>
          <h3>Jugabilidad t√°ctil refinada</h3>
          <ul class="features">
            <li><span>üß©</span><div><strong>Movimiento preciso</strong><br>Arrastra piezas con animaciones suaves y feedback instant√°neo.</div></li>
            <li><span>‚ö°</span><div><strong>Pistas din√°micas</strong><br>Destaca los movimientos viables para mantener el ritmo sin frustraci√≥n.</div></li>
            <li><span>‚è±Ô∏è</span><div><strong>Temporizador y r√©cords</strong><br>Controla tu mejor tiempo y comparte capturas con tus amistades.</div></li>
          </ul>
        </article>
        <article>
          <h3>Progresi√≥n que engancha</h3>
          <ul class="features">
            <li><span>üìà</span><div><strong>Dificultades escalables</strong><br>Tableros 3x3, 4x4 y 5x5 listos para perfiles casuales o expertos.</div></li>
            <li><span>üèÖ</span><div><strong>Logros tem√°ticos</strong><br>Desbloquea medallas por rachas perfectas, pocos movimientos o velocidad extrema.</div></li>
            <li><span>üîÅ</span><div><strong>Reinicio instant√°neo</strong><br>Comienza una nueva partida con un solo toque para intentar una mejor ruta.</div></li>
          </ul>
        </article>
        <article>
          <h3>Presentaci√≥n inmersiva</h3>
          <ul class="features">
            <li><span>üåå</span><div><strong>Temas gal√°cticos</strong><br>Cambia paletas y fondos para cada constelaci√≥n o temporada.</div></li>
            <li><span>üéµ</span><div><strong>Audio adaptable</strong><br>Integra m√∫sica ambiental y efectos sutiles con disparadores por evento.</div></li>
            <li><span>üì±</span><div><strong>Responsive total</strong><br>Juega en m√≥viles, tablets o escritorio sin perder legibilidad.</div></li>
          </ul>
        </article>
      </div>
    </section>

    <section id="modes">
      <h2>Modos y desaf√≠os</h2>
      <p class="lead">Escoge el nivel de reto perfecto y desbloquea variantes especiales al dominar cada galaxia.</p>
      <ol class="mode-cards">
        <li>
          <strong><span>1</span>Modo Cl√°sico</strong>
          <p>Resuelve tableros 3x3 pensados para introducir mec√°nicas y practicar rutas √≥ptimas.</p>
        </li>
        <li>
          <strong><span>2</span>Modo Pro</strong>
          <p>Enfrenta rompecabezas 4x4 y 5x5 con barajados certificados como resolubles y cron√≥metro competitivo.</p>
        </li>
        <li>
          <strong><span>3</span>Retos Contrarreloj</strong>
          <p>Completa niveles con l√≠mite de tiempo para escalar en la tabla semanal del juego.</p>
        </li>
        <li>
          <strong><span>4</span>Eventos Gal√°cticos</strong>
          <p>Activa layouts tem√°ticos con piezas bloqueadas, meteoritos sorpresa y misiones de colecci√≥n.</p>
        </li>
      </ol>
    </section>

    <section id="updates">
      <h2>Pr√≥ximas actualizaciones</h2>
      <p class="lead">Un vistazo a lo que viene para mantener la experiencia fresca y llena de sorpresas.</p>
      <ol class="update-list">
        <li>
          <strong>Fase 1 ¬∑ Colecci√≥n Nebulosa</strong>
          <p>Nuevo set de tableros con piezas transl√∫cidas, efectos de part√≠culas y desaf√≠os diarios guiados.</p>
        </li>
        <li>
          <strong>Fase 2 ¬∑ Cooperativo local</strong>
          <p>Comparte dispositivo para resolver puzzles por turnos, con indicadores de movimientos por persona.</p>
        </li>
        <li>
          <strong>Fase 3 ¬∑ Editor de niveles</strong>
          <p>Crea galaxias personalizadas, comparte c√≥digos con la comunidad e integra piezas especiales.</p>
        </li>
      </ol>
    </section>

    <section class="faq" id="faq">
      <header>
        <h2>Preguntas frecuentes</h2>
        <p class="lead">Resuelve dudas r√°pidas para potenciar el desarrollo de tu rompecabezas.</p>
      </header>
      <div class="faq-list">
        <article class="faq-card">
          <h3>¬øC√≥mo a√±ado m√°s niveles y ambientaciones?</h3>
          <p>Duplica la matriz de piezas en el script, ajusta el tama√±o del tablero y define nuevos fondos o sprites en las variables CSS. El motor reorganiza autom√°ticamente los n√∫meros y valida que cada combinaci√≥n sea resoluble.</p>
          <p>Puedes sumar sonidos o ilustraciones importando tus archivos en la secci√≥n superior del documento. Todo el flujo funciona con JavaScript puro, por lo que ampliar contenidos no requiere dependencias adicionales.</p>
        </article>
      </div>
    </section>
  </main>
  <footer>
    Puzzle Galaxy ¬∑ Rompecabezas espacial en desarrollo ¬∑ Construido con HTML, CSS y JavaScript puro.
  </footer>

  <script>
    const boardEl = document.querySelector('.board');
    const movesEl = document.getElementById('moves');
    const timeEl = document.getElementById('time');
    const bestEl = document.getElementById('best');
    const statusEl = document.querySelector('.status');
    const difficultySelect = document.querySelector('select');
    const bestKey = 'puzzle-galaxy-best';

    let size = parseInt(difficultySelect.value, 10);
    let tiles = [];
    let emptyIndex = size * size - 1;
    let moves = 0;
    let time = 0;
    let timerId = null;

    function coords(index) {
      return { row: Math.floor(index / size), col: index % size };
    }

    function getNeighbors(index) {
      const { row, col } = coords(index);
      const neighbors = [];
      if (row > 0) neighbors.push(index - size);
      if (row < size - 1) neighbors.push(index + size);
      if (col > 0) neighbors.push(index - 1);
      if (col < size - 1) neighbors.push(index + 1);
      return neighbors;
    }

    function createSolvedArray() {
      const arr = [];
      for (let i = 1; i < size * size; i += 1) {
        arr.push(i);
      }
      arr.push(0);
      return arr;
    }

    function shuffleArray() {
      const arr = createSolvedArray();
      let empty = arr.length - 1;
      const iterations = size * size * 50;
      for (let i = 0; i < iterations; i += 1) {
        const neighbors = getNeighbors(empty);
        const pick = neighbors[Math.floor(Math.random() * neighbors.length)];
        arr[empty] = arr[pick];
        arr[pick] = 0;
        empty = pick;
      }
      return { arr, empty };
    }

    function render() {
      boardEl.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
      boardEl.innerHTML = '';
      tiles.forEach((value, index) => {
        const tile = document.createElement('button');
        tile.type = 'button';
        tile.className = value === 0 ? 'tile empty' : 'tile';
        tile.dataset.index = index;
        tile.setAttribute('aria-label', value === 0 ? 'Espacio vac√≠o' : `Ficha ${value}`);
        if (value !== 0) {
          tile.textContent = value;
        }
        boardEl.appendChild(tile);
      });
    }

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
      const secs = (seconds % 60).toString().padStart(2, '0');
      return `${mins}:${secs}`;
    }

    function updateStats() {
      movesEl.textContent = moves;
      timeEl.textContent = formatTime(time);
      const record = getBestTime(size);
      bestEl.textContent = record ? `${record.moves} mov ¬∑ ${formatTime(record.time)}` : '--';
    }

    function startTimer() {
      clearInterval(timerId);
      timerId = setInterval(() => {
        time += 1;
        timeEl.textContent = formatTime(time);
      }, 1000);
    }

    function stopTimer() {
      clearInterval(timerId);
      timerId = null;
    }

    function setStatus(message, tone = 'info') {
      const colors = {
        info: 'var(--muted)',
        success: 'var(--success)',
        warning: 'var(--warning)',
        danger: 'var(--danger)'
      };
      statusEl.innerHTML = `<strong style="color:${colors[tone] || colors.info}">${message}</strong>`;
    }

    function isSolved() {
      for (let i = 0; i < tiles.length - 1; i += 1) {
        if (tiles[i] !== i + 1) {
          return false;
        }
      }
      return tiles[tiles.length - 1] === 0;
    }

    function saveBestTime(record) {
      const stored = JSON.parse(localStorage.getItem(bestKey) || '{}');
      stored[size] = record;
      localStorage.setItem(bestKey, JSON.stringify(stored));
    }

    function getBestTime(currentSize) {
      const stored = JSON.parse(localStorage.getItem(bestKey) || '{}');
      return stored[currentSize];
    }

    function maybeUpdateBest() {
      const record = getBestTime(size);
      if (!record || time < record.time || (time === record.time && moves < record.moves)) {
        saveBestTime({ time, moves });
        setStatus('¬°Nuevo r√©cord gal√°ctico! üéâ', 'success');
      } else {
        setStatus('Puzzle completado. ¬°Sigue escalando posiciones! üöÄ', 'success');
      }
      updateStats();
    }

    function resetGame(newSize = size) {
      size = newSize;
      const { arr, empty } = shuffleArray();
      tiles = arr;
      emptyIndex = empty;
      moves = 0;
      time = 0;
      stopTimer();
      startTimer();
      render();
      updateStats();
      setStatus('Tablero listo. Desliza las fichas para ordenar de menor a mayor.');
    }

    function swap(index) {
      [tiles[emptyIndex], tiles[index]] = [tiles[index], tiles[emptyIndex]];
      emptyIndex = index;
    }

    function moveTile(index) {
      if (tiles[index] === 0) return;
      if (!getNeighbors(index).includes(emptyIndex)) {
        setStatus('Solo puedes mover fichas junto al espacio vac√≠o.', 'warning');
        return;
      }
      swap(index);
      moves += 1;
      render();
      updateStats();
      if (isSolved()) {
        stopTimer();
        maybeUpdateBest();
      }
    }

    function hint() {
      const neighbors = getNeighbors(emptyIndex).filter((i) => tiles[i] !== 0);
      const target = neighbors[Math.floor(Math.random() * neighbors.length)];
      const value = tiles[target];
      setStatus(`Prueba mover la ficha ${value} hacia el espacio libre.`, 'info');
    }

    boardEl.addEventListener('click', (event) => {
      const tile = event.target.closest('.tile');
      if (!tile) return;
      const index = Number(tile.dataset.index);
      moveTile(index);
    });

    document.body.addEventListener('keydown', (event) => {
      if (!['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(event.key)) return;
      event.preventDefault();
      let target;
      if (event.key === 'ArrowUp') target = emptyIndex + size;
      if (event.key === 'ArrowDown') target = emptyIndex - size;
      if (event.key === 'ArrowLeft') target = emptyIndex + 1;
      if (event.key === 'ArrowRight') target = emptyIndex - 1;
      if (target != null && target >= 0 && target < tiles.length) {
        if (getNeighbors(target).includes(emptyIndex)) {
          moveTile(target);
        }
      }
    });

    document.querySelector('[data-action="shuffle"]').addEventListener('click', () => {
      resetGame(size);
    });

    document.querySelector('[data-action="hint"]').addEventListener('click', () => {
      hint();
    });

    difficultySelect.addEventListener('change', (event) => {
      const newSize = parseInt(event.target.value, 10);
      resetGame(newSize);
    });

    resetGame(size);
  </script>
</body>
</html>
